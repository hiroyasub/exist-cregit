<?xml version="1.0" encoding="UTF-8"?>
<book xmlns:ci="http://apache.org/cocoon/include/1.0">

	<bookinfo>
		<graphic fileref="logo.jpg" />
		<productname>Open Source Native XML Database</productname>
		<title>Updating from Older eXist Versions</title>
		<author>
			<firstname>Wolfgang M.</firstname>
			<surname>Meier</surname>
			<affiliation>
				<address format="linespecific">
					<email>wolfgang@exist-db.org</email>
				</address>
			</affiliation>
		</author>
	</bookinfo>

	<ci:include src="sidebar.xml" />

	<chapter>
		<title>Upgrading from an Older Version</title>

		<para>
			When updating from 1.0b1, just installing the new release
			over the old installation will not work. The binary storage
			format of the database files and the encoding of passwords
			have changed. In particular, the old md5-encoded passwords
			in /db/system/users.xml don't match the keys generated by
			the 1.0b2 release (we had to change the encoding in order to
			support HTTP digest authentication as required by WebDAV).
			Restoring the data from a backup doesn't help as the old md5
			keys are restored.
		</para>

		<para>
			To migrate your data to the new release, you should first
			create a backup of the old data using the backup feature of
			the Java client. Backup is fastest if you stop any running
			server and start the client from the old installation
			directory in local mode:
		</para>

		<synopsis>bin/client.sh -l</synopsis>

		<para>
			You can then later switch to the new installation directory
			and do a restore. Concerning user passwords, there are two
			possiblities:
		</para>

		<orderedlist>
			<listitem>
				<para>
					before doing the restore, edit /db/system/users.xml
					in your backup directory and remove the password
					attribute in each user. Then restore into a fresh
					database. All users will now have an empty password
					and you can give them a new one.
				</para>
			</listitem>
			<listitem>
				<para>
					if you have to preserve the old passwords, edit
					src/org/exist/security/security.properties to switch
					back to the old password encoding scheme. The file
					should contain:
				</para>

				<synopsis>passwords.encoding=simple-md5</synopsis>

				<para>
					then rebuild the jars by calling build.bat or
					build.sh.
				</para>
			</listitem>
		</orderedlist>
	</chapter>
</book>