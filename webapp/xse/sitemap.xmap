<?xml version="1.0" encoding="UTF-8"?>
<!-- 
Copyright J.M. Vanel 2003 - under Lesser GNU public licence 
jmvanel@free.fr 

Worldwide Botanical Knowledge Base 
http://wwbota.free.fr/
$Header$
-->
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

    <!-- =========================== Views =================================== -->
    <!--
  Views provide diffent, well, views to resources. Views are
  orthogonal to pipelines. Please refer to the docs.
-->
    <map:views>
        <map:view from-label="content" name="content">
            <map:serialize type="xml"/>
        </map:view>
        <map:view from-label="content" name="content1" >
            <map:serialize type="xml"/>
        </map:view>
        <map:view from-label="content" name="content2" >
            <map:serialize type="xml"/>
        </map:view>
        <map:view from-label="data" name="pretty-content">
            <map:transform src="stylesheets/simple-xml2html.xsl"/>
            <map:serialize type="html"/>
        </map:view>
        <map:view from-position="last" name="links">
            <map:serialize type="links"/>
        </map:view>
    </map:views>
    
    <!-- pipelines -->
    <map:pipelines>

         <map:pipeline>
               <!-- This causes directories added under "mount"
               (even with Cocoon already running) to be activated automagically
               if they contain a sitemap.xmap, without having to modify the main
               sitemap.xmap
             -->
               <map:match pattern="mount/*/**">
                 <map:mount check-reload="yes" src="mount/{1}/" uri-prefix="mount/{1}" />
               </map:match>
               <map:match pattern="">
                 <map:redirect-to uri="index.xml"/>
               </map:match>
         </map:pipeline>

        <map:pipeline>
            <!-- graphics etc. -->
            <map:match pattern="**.css">
                <map:read mime-type="text/css" src="{1}.css"/>
            </map:match>
            <map:match pattern="**.jpg">
                <map:read mime-type="text/jpg" src="{1}.jpg"/>
            </map:match>
            <map:match pattern="**.gif">
                <map:read mime-type="text/gif" src="{1}.gif"/>
            </map:match>
            <map:match pattern="**.png">
                <map:read mime-type="text/png" src="{1}.png"/>
            </map:match>
            <map:match pattern="**.dtd">
                <map:read mime-type="text/text" src="{1}.dtd"/>
            </map:match>
            <map:match pattern="**.html">
                <map:read src="{1}.html" mime-type="text/html"/>
            </map:match>
            <map:match pattern="**.js">
                <map:read src="{1}.js" mime-type="text/javascript"/>
            </map:match>

            <!-- pipelines using the xmldb:// pseudo-protocol -->
            
            <map:match pattern="xmldb/db/xinclude/**.xml">
                <map:generate src="xmldb:exist:///db/xinclude/{1}.xml"/>
                <map:transform src="stylesheets/db2html.xsl"/>
                <map:serialize type="html"/>
            </map:match>
            
            <!-- apply stylesheet shakes.xsl to all XML documents -->
            <!-- in xmldb-collection /db/shakespeare/plays -->
            <map:match pattern="xmldb/db/shakespeare/plays/**.xml">
                <map:match pattern="xpath" type="request-parameter">
                    <!-- check if an xpath query has been passed in the request -->
                    <map:generate src="xmldb:exist:///db/shakespeare/plays/{../1}.xml#{1}"/>
                    <map:act type="request">
                        <!-- convert request parameters into sitemap parameters -->
                        <map:parameter name="parameters" value="true"/>
                        <map:parameter name="default.howmany" value="10"/>
                        <map:parameter name="default.start" value="1"/>
                        <!-- we don't want to display all results on one page,
                     so we use the filter-transformer to filter out 
                     everything except the block we would like to see.
                 -->
                        <map:transform type="filter">
                            <map:parameter name="element-name" value="result"/>
                            <map:parameter name="count" value="{howmany}"/>
                            <map:parameter name="blocknr" value="{start}"/>
                        </map:transform>
                        <map:transform src="stylesheets/xmldb-query.xsl">
                            <map:parameter name="block" value="{start}"/>
                            <map:parameter name="collection" value="/db/shakespeare/plays"/>
                            <map:parameter name="resource" value="{../../1}.xml"/>
                        </map:transform>
                    </map:act>
                    <map:serialize type="html"/>
                </map:match>
                <map:generate src="xmldb:exist:///db/shakespeare/plays/{1}.xml"/>
                <map:transform src="xmldb:exist:///db/shakespeare/plays/shakes.xsl"/>
                <map:serialize type="html"/>
            </map:match>
            
            <!-- browse collections -->
            <map:match pattern="xmldb/**/">
                <!-- check if an xpath query has been passed in the request -->
                <map:match pattern="xpath" type="request-parameter">
                    <map:generate src="xmldb:exist:///{../1}/#{1}"/>
                    <map:act type="request">
                        <!-- convert request parameters into sitemap parameters -->
                        <map:parameter name="parameters" value="true"/>
                        <map:parameter name="default.howmany" value="10"/>
                        <map:parameter name="default.start" value="1"/>
                        <!-- we don't want to display all results on one page,
                     so we use the filter-transformer to filter out 
                     everything except the block we would like to see.
                 -->
                        <map:transform type="filter">
                            <map:parameter name="element-name" value="result"/>
                            <map:parameter name="count" value="{howmany}"/>
                            <map:parameter name="blocknr" value="{start}"/>
                        </map:transform>
                        <map:transform src="stylesheets/xmldb-query.xsl">
                            <map:parameter name="block" value="{start}"/>
                            <map:parameter name="collection" value="{../../1}"/>
                        </map:transform>
                    </map:act>
                    <map:serialize type="html"/>
                </map:match>
                <!-- no xpath query has been specified: display collection contents -->
                <map:generate src="xmldb:exist:///{1}/"/>
                <map:transform src="stylesheets/xmldb-collection.xsl">
                    <map:parameter name="collection" value="{1}"/>
                </map:transform>
                <map:serialize type="html"/>
            </map:match>
            
            <!-- display source XML for other resources -->
            <map:match pattern="xmldb/**">
                <map:match pattern="xpath" type="request-parameter">
                    <!-- check if an xpath query has been passed in the request -->
                    <map:generate src="xmldb:exist:///{../1}#{1}"/>
                    <map:act type="request">
                        <!-- convert request parameters into sitemap parameters -->
                        <map:parameter name="parameters" value="true"/>
                        <map:parameter name="default.howmany" value="10"/>
                        <map:parameter name="default.start" value="1"/>
                        <!-- we don't want to display all results on one page,
                     so we use the filter-transformer to filter out 
                     everything except the block we would like to see.
                 -->
                        <map:transform type="filter">
                            <map:parameter name="element-name" value="result"/>
                            <map:parameter name="count" value="{howmany}"/>
                            <map:parameter name="blocknr" value="{start}"/>
                        </map:transform>
                        <map:transform src="stylesheets/xmldb-query.xsl">
                            <map:parameter name="block" value="{start}"/>
                            <map:parameter name="collection" value="{../../1}"/>
                        </map:transform>
                    </map:act>
                    <map:serialize type="html"/>
                </map:match>
                <map:generate src="xmldb:exist:///{1}"/>
                <map:select type="browser">
                    <map:when test="explorer">
                        <map:serialize type="xml"/>
                    </map:when>
                    <map:otherwise>
                        <map:transform src="stylesheets/simple-xml2html.xsl"/>
                        <map:serialize type="html"/>
                    </map:otherwise>
                </map:select>
            </map:match>
            
            <map:match pattern="**.xmap">
                <map:generate src="{1}.xmap"/>
                <map:transform src="stylesheets/sitemap/simple-sitemap2html.xsl"/>
                <map:serialize type="html"/>
            </map:match>
            
            <map:match pattern="example1.xsp">
                <map:generate src="test.xsp" type="serverpages"/>
                <map:transform src="stylesheets/doc2html-2.xsl"/>
                <map:serialize type="xhtml"/>
            </map:match>
            
            <map:match pattern="index.xml">
                <map:generate src="index.xml"/>
                <map:transform type="cinclude"/>
                <map:transform src="stylesheets/doc2html-2.xsl"/>
                <map:serialize type="html"/>
            </map:match>
            
            <map:match pattern="squery.xsp">
                <map:generate src="squery.xsp" type="serverpages" />
                <map:transform type="cinclude"/>
                <map:transform src="stylesheets/doc2html-3.xsl"/>
                <map:serialize encoding="ISO-8859-1" type="xhtml"/>
            </map:match>

             <map:match pattern="sprocess.xsp">
                <map:generate src="sprocess.xsp" type="serverpages"/>
                <map:transform type="cinclude"/>
                <map:transform src="cocoon:/highlight.xslt.xsp" label="content1" >
                  <map:parameter name="use-request-parameters" value="true"/>
                </map:transform>
              <map:act type="request">
                <map:parameter name="parameters" value="true"/>
                <map:transform src="stylesheets/highlight.xslt" label="content3" /> 
                <map:transform src="stylesheets/{collection}/display.xslt" label="content2" />
                <map:transform src="stylesheets/doc2html-3.xsl" label="content3" /> 
                <map:serialize encoding="ISO-8859-1" type="xhtml" />
              </map:act>
            </map:match>

            <map:match pattern="squery-foc.xsp">
                <map:generate src="squery-foc.xsp" type="serverpages" />
                <map:transform type="cinclude"/>
                <map:transform src="stylesheets/doc2html-3.xsl"/>
                <map:serialize encoding="ISO-8859-1" type="xhtml"/>
            </map:match>

            <map:match pattern="sprocess-foc.xsp">
              <map:generate src="sprocess-foc.xsp" type="serverpages"/>
              <map:transform type="cinclude"/>
              <map:act type="request">
                <map:parameter name="parameters" value="true"/>
                <map:transform src="stylesheets/highlight.xslt" label="content3" /> 
                <map:transform src="stylesheets/{collection}/display.xslt" label="content2" />
                <map:transform src="stylesheets/doc2html-3.xsl" label="content3" /> 
                <map:serialize encoding="ISO-8859-1" type="xhtml" />
              </map:act>
            </map:match>

            <!-- this is a protected resource: it uses the xmldb-login action
            to authenticate a user against the database -->
            <map:match pattern="xadmin.xsp">
                <map:act src="xmldb:exist:///db" type="xmldb-login">
                    <map:generate src="xadmin.xsp" type="serverpages"/>
                    <map:transform type="cinclude">
                        <map:parameter name="use-request-parameters" value="true"/>
                    </map:transform>
                    <map:transform src="stylesheets/doc2html-2.xsl">
                        <map:parameter name="use-request-parameters" value="true"/>
                    </map:transform>
                    <map:serialize encoding="UTF-8" type="xhtml"/>
                </map:act>
                <!-- no session found: display login form -->
                <map:generate src="login.xml"/>
                <map:transform type="cinclude"/>
                <map:transform src="stylesheets/doc2html-2.xsl"/>
                <map:serialize type="xhtml"/>
            </map:match>
            
            <map:match pattern="**.xsp">
                <map:generate src="{1}.xsp" type="serverpages"/>
                <map:transform type="cinclude"/>
                <map:transform src="stylesheets/doc2html-2.xsl"/>
                <map:serialize encoding="ISO-8859-1" type="xhtml"/>
            </map:match>
            
            <!-- Documentation -->
            <map:match pattern="**.xml">
                <map:generate src="{1}.xml"/>
                <map:transform type="cinclude"/>
                <map:transform src="stylesheets/db2html.xsl"/>
                <map:serialize type="xhtml"/>
            </map:match>
            
            <map:match pattern="**/">
                <map:generate src="{1}" type="directory"/>
                <map:transform src="context://stylesheets/system/directory2html.xsl"/>
                <map:serialize/>
            </map:match>
            <map:handle-errors>
                <map:transform src="context://stylesheets/system/error2html.xsl"/>
                <map:serialize status-code="500"/>
            </map:handle-errors>
        </map:pipeline>
    </map:pipelines>
</map:sitemap>
<!-- end of file -->
