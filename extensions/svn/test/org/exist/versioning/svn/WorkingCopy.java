begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * ====================================================================  * Copyright (c) 2004-2010 TMate Software Ltd.  All rights reserved.  *  * This software is licensed as described in the file COPYING, which  * you should have received as part of this distribution.  The terms  * are also available at http://svnkit.com/license.html  * If newer versions of this license are posted there, you may use a  * newer version instead, at your option.  * ====================================================================  */
end_comment

begin_package
package|package
name|org
operator|.
name|exist
operator|.
name|versioning
operator|.
name|svn
package|;
end_package

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|Assert
operator|.
name|fail
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileNotFoundException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|OutputStream
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|storage
operator|.
name|DBBroker
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|versioning
operator|.
name|svn
operator|.
name|Resource
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|versioning
operator|.
name|svn
operator|.
name|internal
operator|.
name|wc
operator|.
name|DefaultSVNOptions
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|versioning
operator|.
name|svn
operator|.
name|wc
operator|.
name|ISVNEventHandler
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|versioning
operator|.
name|svn
operator|.
name|wc
operator|.
name|SVNClientManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|versioning
operator|.
name|svn
operator|.
name|wc
operator|.
name|SVNCopySource
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|versioning
operator|.
name|svn
operator|.
name|wc
operator|.
name|SVNUpdateClient
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|versioning
operator|.
name|svn
operator|.
name|wc
operator|.
name|SVNWCUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|exist
operator|.
name|xmldb
operator|.
name|DatabaseInstanceManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|AfterClass
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|BeforeClass
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|SVNCommitInfo
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|SVNDepth
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|SVNException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|SVNURL
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|internal
operator|.
name|io
operator|.
name|dav
operator|.
name|DAVRepositoryFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|internal
operator|.
name|io
operator|.
name|fs
operator|.
name|FSRepositoryFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|internal
operator|.
name|io
operator|.
name|svn
operator|.
name|SVNRepositoryFactoryImpl
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|internal
operator|.
name|util
operator|.
name|SVNPathUtil
import|;
end_import

begin_import
import|import
name|org
operator|.
name|tmatesoft
operator|.
name|svn
operator|.
name|core
operator|.
name|wc
operator|.
name|SVNRevision
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xmldb
operator|.
name|api
operator|.
name|DatabaseManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xmldb
operator|.
name|api
operator|.
name|base
operator|.
name|Collection
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xmldb
operator|.
name|api
operator|.
name|base
operator|.
name|Database
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xmldb
operator|.
name|api
operator|.
name|base
operator|.
name|XMLDBException
import|;
end_import

begin_import
import|import
name|org
operator|.
name|xmldb
operator|.
name|api
operator|.
name|modules
operator|.
name|CollectionManagementService
import|;
end_import

begin_comment
comment|/*  * This  is  a complex  example program that demonstrates how  you  can manage local  * working copies as well as  URLs  (that is, items located  in  the  repository) by   * means of the  API  provided in the org.tmatesoft.svn.core.wc package. The package   * itself represents  a  high-level  API  consisting of classes and interfaces which   * allow to perform operations compatible with ones of the native Subversion command  * line client.  These version control operations are logically grouped in a  set of   * classes which names meet  'SVN*Client'  pattern. For example, the package has the   * SVNUpdateClient class which is responsible for update-related operations (update,  * switch, check out). Most of the  methods of these 'client' classes are named like  * 'doSomething(..)' where 'Something' corresponds to the name of a version  control   * operation (usually similar to the name of the  corresponding  Subversion  command   * line client's command). So, for  users  familiar with the Subversion command line   * client it won't take much  effort and time  to  match a 'do*' method  against  an   * appropriate Subversion client's operation (or command, in other words).  *   * Surely, it  may  seem  not  quite handy to deal with a number of classes that all   * need to be instantiated, initialized, kept.. For example, if a developer is going   * to use all (or several) of the SVN*Client classes and most of them will access  a   * repository (in that way when authentication is demanded), it becomes tiresome  to   * provide authentication info to every one of them. So, for managing purposes  like   * the previous one the  package  has got the class  called  SVNClientManager  whose   * get*Client() methods provide all necessary SVN*Client objects to a caller.   *   * A  developer once creates an instance of  SVNClientManager  providing (if needed)   * his  authentication  info/options (options  are  similar  to  the   SVN  run-time   * configuration settings that can be found in the config file) into an  appropriate   * SVNClientManager.newInstance(..) method. Further all SVN*Client objects  provided   * by the instance of SVNClientManager will use these authentication info/options.     *    * The program illustrates a  number  of  main  operations  usually carried out upon   * working copies and URLs. Here's a brief description  of  what  the  program  does   * (main steps):  *   * 0)first of all initializes the  SVNKit  library  (it must be done prior to using   * the library);  *   * 1)if the program was run with some in parameters, it fetches them out of the args   * parameter; the program expects the following input parameters:   *   * repositoryURL wcRootPath name password   *   * 2)next instantiates an SVNClientManager providing default options and  auth  info   * to it -  these parameters will be used by  all  SVN*Client  objects that will  be  * created, kept and provided by the manager; default run-time options correspond to   * the client-side run-time settings found in the  'config'  file within the default   * SVN configuration area; also in this case the client manager will use the server-  * side run-time settings found in the 'servers' file within the same area;  *   * 3)the first operation  -  making an empty directory in a repository; that is like   * 'svn mkdir URL'  which  creates  a  new  directory  given  all  the  intermediate   * directories created); this operation is immediately committed to the repository;  *   * 4)the next operation  - creating a new local directory (importDir) and a new file   * (importFile) in it and then importing the directory into the repository;   *   * 5)the next operation - checking out the directory created in the previous step to   * a local directory defined by the myWorkingCopyPath parameter ;   *   * 6)the next operation  -  recursively getting and displaying info for each item at   * the working revision in the working copy that was  checked  out  in  the previous   * step;  *   * 7)the next operation - creating a new directory (newDir) with a file (newFile) in  * the working copy and then  recursively  scheduling (if any subdirictories existed   * they would be also added:)) the created directory for addition;  *   * 8)the next operation - recursively getting and displaying the working copy status  * not including unchanged (normal) paths; the result must include those paths which  * were scheduled for addition in the previous step;   *   * 9)the next operation  - recursively updating the working copy; if any local items  * are out of date they will be updated to the latest revision;  *   * 10)the next operation - committing local changes to the repository; this will add   * the directory with the file (that were  scheduled  for addition two steps before)   * to the repository;  *   * 11)the next operation  -  locking  the  file  committed in the previous step (for   * example, if you temporarily need to keep a file locked to prevent someone's  else   * modifications);  *   * 12)the next operation  -  showing status once again (here, to see that  the  file   * was locked);  *   * 13)the next operation  -  copying  with  history  one  URL (url)  to another  one   * (copyURL) within the same repository;  *   * 14)the next operation - switching the working copy to a different  URL  (copyURL)  * where url was copied to in the previous step;  *   * 15)the next operation  -  recursively  getting  and  displaying  info on the root   * directory of the working copy to demonstrate that the working copy is now  really  * switched against copyURL;  *   * 16)the next operation - scheduling the newDir directory for deletion;  *   * 17)the next operation  -  showing  status  once  again  (here, to  see  that  the   * directory with all its entries were scheduled for deletion);  *   * 18)the next operation - committing local changes to the repository; this operation  * will delete the directory (newDir) with the file (newFile) that were scheduled for  * deletion from the repository;  *   *                                    * * *  *                                      * This example can be  run  for a locally  installed  Subversion  repository via the   * svn:// protocol. This is how you can do it:  *   * 1)after you install the Subversion on your machine (SVN is available for  download   * at  http://subversion.tigris.org/),  you should  create  a  new  repository  in  a   * directory, like this (in a command line under a Windows OS):  *   *>svnadmin create X:\path\to\rep  *   * 2)after the repository is created you can add a new account: open X:\path\to\rep\,   * then move into \conf and open the file - 'passwd'.  In  the file  you'll  see  the   * section [users]. Uncomment it and add a new account below the section name, like:  *   * [users]   * userName = userPassword  *   * In the program you may further use this account as user's credentials.  *   * 3)the  next  step  is  to  launch  the  custom  Subversion  server (svnserve) in a   * background mode for the just created repository:  *   *>svnserve -d -r X:\path\to  *   * That's all. The repository is now available via  svn://localhost/rep.  *   *                                    * * *  *   * While  the  program  is  running, in your console  you'll see something like this:    	Making a new directory at 'svn://localhost/testRep/MyRepos'... 	Committed to revision 70 	 	Importing a new directory into 'svn://localhost/testRep/MyRepos/importDir'... 	Adding         importFile.txt 	Committed to revision 71 	 	Checking out a working copy from 'svn://localhost/testRep/MyRepos'... 	A         importDir 	A         importDir/importFile.txt 	At revision 71 	 	-----------------INFO----------------- 	Local Path: N:\MyWorkingCopy 	URL: svn://localhost/testRep/MyRepos 	Repository UUID: dbe83c44-f5aa-e043-94ec-ecdf6c56480f 	Revision: 71 	Node Kind: dir 	Schedule: normal 	Last Changed Author: userName 	Last Changed Revision: 71 	Last Changed Date: Thu Jul 21 23:43:15 NOVST 2005 	-----------------INFO----------------- 	Local Path: N:\MyWorkingCopy\importDir 	URL: svn://localhost/testRep/MyRepos/importDir 	Repository UUID: dbe83c44-f5aa-e043-94ec-ecdf6c56480f 	Revision: 71 	Node Kind: dir 	Schedule: normal 	Last Changed Author: userName 	Last Changed Revision: 71 	Last Changed Date: Thu Jul 21 23:43:15 NOVST 2005 	-----------------INFO----------------- 	Local Path: N:\MyWorkingCopy\importDir\importFile.txt 	URL: svn://localhost/testRep/MyRepos/importDir/importFile.txt 	Repository UUID: dbe83c44-f5aa-e043-94ec-ecdf6c56480f 	Revision: 71 	Node Kind: file 	Schedule: normal 	Last Changed Author: userName 	Last Changed Revision: 71 	Last Changed Date: Thu Jul 21 23:43:15 NOVST 2005 	Properties Last Updated: Thu Jul 21 23:43:16 NOVST 2005 	Text Last Updated: Thu Jul 21 23:43:16 NOVST 2005 	Checksum: 75e9e68e21ae4453f318424738aef57e 	 	Recursively scheduling a new directory 'N:\MyWorkingCopy\newDir' for addition... 	A     newDir 	A     newDir/newFile.txt 	 	Status for 'N:\MyWorkingCopy': 	A          0     ?    ?                 N:\MyWorkingCopy\newDir\newFile.txt 	A          0     ?    ?                 N:\MyWorkingCopy\newDir 	 	Updating 'N:\MyWorkingCopy'... 	At revision 71 	 	Committing changes for 'N:\MyWorkingCopy'... 	Adding         newDir 	Adding         newDir/newFile.txt 	Transmitting file data.... 	Committed to revision 72 	 	Locking (with stealing if the entry is already locked) 'N:\MyWorkingCopy\newDir\newFile.txt'. 	L     newFile.txt 	 	Status for 'N:\MyWorkingCopy': 	     K     72    72    userName         N:\MyWorkingCopy\newDir\newFile.txt 	 	Copying 'svn://localhost/testRep/MyRepos' to 'svn://localhost/testRep/MyReposCopy'... 	Committed to revision 73 	 	Switching 'N:\MyWorkingCopy' to 'svn://localhost/testRep/MyReposCopy'... 	  B       newDir/newFile.txt 	At revision 73 	 	-----------------INFO----------------- 	Local Path: N:\MyWorkingCopy 	URL: svn://localhost/testRep/MyReposCopy 	Repository UUID: dbe83c44-f5aa-e043-94ec-ecdf6c56480f 	Revision: 73 	Node Kind: dir 	Schedule: normal 	Last Changed Author: userName 	Last Changed Revision: 73 	Last Changed Date: Thu Jul 21 23:43:19 NOVST 2005 	-----------------INFO----------------- 	Local Path: N:\MyWorkingCopy\importDir 	URL: svn://localhost/testRep/MyReposCopy/importDir 	Repository UUID: dbe83c44-f5aa-e043-94ec-ecdf6c56480f 	Revision: 73 	Node Kind: dir 	Schedule: normal 	Last Changed Author: userName 	Last Changed Revision: 71 	Last Changed Date: Thu Jul 21 23:43:15 NOVST 2005 	-----------------INFO----------------- 	Local Path: N:\MyWorkingCopy\importDir\importFile.txt 	URL: svn://localhost/testRep/MyReposCopy/importDir/importFile.txt 	Repository UUID: dbe83c44-f5aa-e043-94ec-ecdf6c56480f 	Revision: 73 	Node Kind: file 	Schedule: normal 	Last Changed Author: userName 	Last Changed Revision: 71 	Last Changed Date: Thu Jul 21 23:43:15 NOVST 2005 	Properties Last Updated: Thu Jul 21 23:43:16 NOVST 2005 	Text Last Updated: Thu Jul 21 23:43:16 NOVST 2005 	Checksum: 75e9e68e21ae4453f318424738aef57e 	-----------------INFO----------------- 	Local Path: N:\MyWorkingCopy\newDir 	URL: svn://localhost/testRep/MyReposCopy/newDir 	Repository UUID: dbe83c44-f5aa-e043-94ec-ecdf6c56480f 	Revision: 73 	Node Kind: dir 	Schedule: normal 	Last Changed Author: userName 	Last Changed Revision: 72 	Last Changed Date: Thu Jul 21 23:43:18 NOVST 2005 	-----------------INFO----------------- 	Local Path: N:\MyWorkingCopy\newDir\newFile.txt 	URL: svn://localhost/testRep/MyReposCopy/newDir/newFile.txt 	Repository UUID: dbe83c44-f5aa-e043-94ec-ecdf6c56480f 	Revision: 73 	Node Kind: file 	Schedule: normal 	Last Changed Author: userName 	Last Changed Revision: 72 	Last Changed Date: Thu Jul 21 23:43:18 NOVST 2005 	Properties Last Updated: Thu Jul 21 23:43:20 NOVST 2005 	Text Last Updated: Thu Jul 21 23:43:18 NOVST 2005 	Checksum: 023b67e9660b2faabaf84b10ba32c6cf 	 	Scheduling 'N:\MyWorkingCopy\newDir' for deletion ... 	D     newDir/newFile.txt 	D     newDir 	 	Status for 'N:\MyWorkingCopy': 	D          73    72    userName         N:\MyWorkingCopy\newDir\newFile.txt 	D          73    72    userName         N:\MyWorkingCopy\newDir 	 	Committing changes for 'N:\MyWorkingCopy'... 	Deleting   newDir 	Committed to revision 74  *   */
end_comment

begin_class
specifier|public
class|class
name|WorkingCopy
block|{
specifier|private
specifier|static
name|String
name|myHomePath
init|=
literal|"/db"
decl_stmt|;
specifier|private
specifier|static
name|String
name|myWorkingCopyName
init|=
literal|"MyWorkingCopy"
decl_stmt|;
specifier|private
specifier|static
name|String
name|myWorkingCopyPath
init|=
literal|"/"
operator|+
name|myWorkingCopyName
decl_stmt|;
specifier|private
specifier|static
name|String
name|importDirName
init|=
literal|"importDir"
decl_stmt|;
specifier|private
specifier|static
name|String
name|importDir
init|=
literal|"/"
operator|+
name|importDirName
decl_stmt|;
specifier|private
specifier|static
name|SVNClientManager
name|ourClientManager
decl_stmt|;
specifier|private
specifier|static
name|ISVNEventHandler
name|myCommitEventHandler
decl_stmt|;
specifier|private
specifier|static
name|ISVNEventHandler
name|myUpdateEventHandler
decl_stmt|;
specifier|private
specifier|static
name|ISVNEventHandler
name|myWCEventHandler
decl_stmt|;
annotation|@
name|Test
specifier|public
name|void
name|test
parameter_list|()
throws|throws
name|SVNException
block|{
comment|/*          * Initializes the library (it must be done before ever using the library           * itself)          */
name|setupLibrary
argument_list|()
expr_stmt|;
comment|/*          * Default values:          */
comment|/*          * Assuming that 'svn://localhost/testRep' is an existing repository path.          * SVNURL is a wrapper for URL strings that refer to repository locations.          */
name|SVNURL
name|repositoryURL
init|=
literal|null
decl_stmt|;
try|try
block|{
name|repositoryURL
operator|=
name|SVNURL
operator|.
name|parseURIEncoded
argument_list|(
literal|"svn://localhost/svn/"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|e
parameter_list|)
block|{
comment|//
block|}
name|String
name|name
init|=
literal|"harry"
decl_stmt|;
name|String
name|password
init|=
literal|"harryssecret"
decl_stmt|;
name|String
name|importFile
init|=
name|importDir
operator|+
literal|"/importFile.txt"
decl_stmt|;
name|String
name|importFileText
init|=
literal|"This unversioned file is imported into a repository"
decl_stmt|;
name|String
name|newDir
init|=
literal|"/newDir"
decl_stmt|;
name|String
name|newFile
init|=
name|newDir
operator|+
literal|"/newFile.txt"
decl_stmt|;
name|String
name|fileText
init|=
literal|"This is a new file added to the working copy"
decl_stmt|;
comment|/*          * That's where a new directory will be created          */
name|SVNURL
name|url
init|=
name|repositoryURL
operator|.
name|appendPath
argument_list|(
literal|"MyRepos"
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|/*          * That's where '/MyRepos' will be copied to (branched)          */
name|SVNURL
name|copyURL
init|=
name|repositoryURL
operator|.
name|appendPath
argument_list|(
literal|"MyReposCopy"
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|/*          * That's where a local directory will be imported into.          * Note that it's not necessary that the '/importDir' directory must already          * exist - the SVN repository server will take care of creating it.           */
name|SVNURL
name|importToURL
init|=
name|url
operator|.
name|appendPath
argument_list|(
name|importDir
argument_list|,
literal|false
argument_list|)
decl_stmt|;
comment|/*          * Creating custom handlers that will process events          */
name|myCommitEventHandler
operator|=
operator|new
name|CommitEventHandler
argument_list|()
expr_stmt|;
name|myUpdateEventHandler
operator|=
operator|new
name|UpdateEventHandler
argument_list|()
expr_stmt|;
name|myWCEventHandler
operator|=
operator|new
name|WCEventHandler
argument_list|()
expr_stmt|;
comment|/*          * Creates a default run-time configuration options driver. Default options           * created in this way use the Subversion run-time configuration area (for           * instance, on a Windows platform it can be found in the '%APPDATA%\Subversion'           * directory).           *           * readonly = true - not to save  any configuration changes that can be done           * during the program run to a config file (config settings will only           * be read to initialize; to enable changes the readonly flag should be set          * to false).          *           * SVNWCUtil is a utility class that creates a default options driver.          */
name|DefaultSVNOptions
name|options
init|=
name|SVNWCUtil
operator|.
name|createDefaultOptions
argument_list|(
literal|true
argument_list|)
decl_stmt|;
comment|/*          * Creates an instance of SVNClientManager providing authentication          * information (name, password) and an options driver          */
name|ourClientManager
operator|=
name|SVNClientManager
operator|.
name|newInstance
argument_list|(
name|options
argument_list|,
name|name
argument_list|,
name|password
argument_list|)
expr_stmt|;
comment|/*          * Sets a custom event handler for operations of an SVNCommitClient           * instance          */
name|ourClientManager
operator|.
name|getCommitClient
argument_list|()
operator|.
name|setEventHandler
argument_list|(
name|myCommitEventHandler
argument_list|)
expr_stmt|;
comment|/*          * Sets a custom event handler for operations of an SVNUpdateClient           * instance          */
name|ourClientManager
operator|.
name|getUpdateClient
argument_list|()
operator|.
name|setEventHandler
argument_list|(
name|myUpdateEventHandler
argument_list|)
expr_stmt|;
comment|/*          * Sets a custom event handler for operations of an SVNWCClient           * instance          */
name|ourClientManager
operator|.
name|getWCClient
argument_list|()
operator|.
name|setEventHandler
argument_list|(
name|myWCEventHandler
argument_list|)
expr_stmt|;
name|long
name|committedRevision
init|=
operator|-
literal|1
decl_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Making a new directory at '"
operator|+
name|url
operator|+
literal|"'..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * creates a new version comtrolled directory in a repository and               * displays what revision the repository was committed to              */
name|committedRevision
operator|=
name|makeDirectory
argument_list|(
name|url
argument_list|,
literal|"making a new directory at '"
operator|+
name|url
operator|+
literal|"'"
argument_list|)
operator|.
name|getNewRevision
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while making a new directory at '"
operator|+
name|url
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Committed to revision "
operator|+
name|committedRevision
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|Resource
name|anImportDir
init|=
operator|new
name|Resource
argument_list|(
name|myHomePath
operator|+
name|importDir
argument_list|)
decl_stmt|;
name|Resource
name|anImportFile
init|=
operator|new
name|Resource
argument_list|(
name|anImportDir
argument_list|,
name|SVNPathUtil
operator|.
name|tail
argument_list|(
name|importFile
argument_list|)
argument_list|)
decl_stmt|;
comment|/*          * creates a new local directory - './importDir' and a new file -           * './importDir/importFile.txt' that will be imported into the repository          * into the '/MyRepos/importDir' directory           */
name|createLocalDir
argument_list|(
name|anImportDir
argument_list|,
operator|new
name|Resource
index|[]
block|{
name|anImportFile
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
name|importFileText
block|}
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Importing a new directory into '"
operator|+
name|importToURL
operator|+
literal|"'..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * recursively imports an unversioned directory into a repository               * and displays what revision the repository was committed to              */
name|boolean
name|isRecursive
init|=
literal|true
decl_stmt|;
name|committedRevision
operator|=
name|importDirectory
argument_list|(
name|anImportDir
argument_list|,
name|importToURL
argument_list|,
literal|"importing a new directory '"
operator|+
name|anImportDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|isRecursive
argument_list|)
operator|.
name|getNewRevision
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while importing a new directory '"
operator|+
name|anImportDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' into '"
operator|+
name|importToURL
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Committed to revision "
operator|+
name|committedRevision
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
comment|/*          * creates a local directory where the working copy will be checked out into          */
name|Resource
name|wcDir
init|=
operator|new
name|Resource
argument_list|(
name|myHomePath
operator|+
name|myWorkingCopyPath
argument_list|)
decl_stmt|;
if|if
condition|(
name|wcDir
operator|.
name|exists
argument_list|()
condition|)
block|{
name|error
argument_list|(
literal|"the destination directory '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' already exists!"
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
name|wcDir
operator|.
name|mkdirs
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Checking out a working copy from '"
operator|+
name|url
operator|+
literal|"'..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * recursively checks out a working copy from url into wcDir.              * SVNRevision.HEAD means the latest revision to be checked out.               */
name|checkout
argument_list|(
name|url
argument_list|,
name|SVNRevision
operator|.
name|HEAD
argument_list|,
name|wcDir
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while checking out a working copy for the location '"
operator|+
name|url
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
comment|/*          * recursively displays info for wcDir at the current working revision           * in the manner of 'svn info -R' command          */
try|try
block|{
name|showInfo
argument_list|(
name|wcDir
argument_list|,
name|SVNRevision
operator|.
name|WORKING
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while recursively getting info for the working copy at'"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|Resource
name|aNewDir
init|=
operator|new
name|Resource
argument_list|(
name|wcDir
argument_list|,
name|newDir
argument_list|)
decl_stmt|;
name|Resource
name|aNewFile
init|=
operator|new
name|Resource
argument_list|(
name|aNewDir
argument_list|,
name|SVNPathUtil
operator|.
name|tail
argument_list|(
name|newFile
argument_list|)
argument_list|)
decl_stmt|;
comment|/*          * creates a new local directory - 'wcDir/newDir' and a new file -           * '/MyWorkspace/newDir/newFile.txt'           */
name|createLocalDir
argument_list|(
name|aNewDir
argument_list|,
operator|new
name|Resource
index|[]
block|{
name|aNewFile
block|}
argument_list|,
operator|new
name|String
index|[]
block|{
name|fileText
block|}
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Recursively scheduling a new directory '"
operator|+
name|aNewDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' for addition..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * recursively schedules aNewDir for addition              */
name|addEntry
argument_list|(
name|aNewDir
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while recursively adding the directory '"
operator|+
name|aNewDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|boolean
name|isRecursive
init|=
literal|true
decl_stmt|;
name|boolean
name|isRemote
init|=
literal|true
decl_stmt|;
name|boolean
name|isReportAll
init|=
literal|false
decl_stmt|;
name|boolean
name|isIncludeIgnored
init|=
literal|true
decl_stmt|;
name|boolean
name|isCollectParentExternals
init|=
literal|false
decl_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Status for '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"':"
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * gets and shows status information for the WC directory.              * status will be recursive on wcDir, will also cover the repository,               * won't cover unmodified entries, will disregard 'svn:ignore' property               * ignores (if any), will ignore externals definitions.              */
name|showStatus
argument_list|(
name|wcDir
argument_list|,
name|isRecursive
argument_list|,
name|isRemote
argument_list|,
name|isReportAll
argument_list|,
name|isIncludeIgnored
argument_list|,
name|isCollectParentExternals
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while recursively performing status for '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Updating '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * recursively updates wcDir to the latest revision (SVNRevision.HEAD)              */
name|update
argument_list|(
name|wcDir
argument_list|,
name|SVNRevision
operator|.
name|HEAD
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while recursively updating the working copy at '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|""
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Committing changes for '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * commits changes in wcDir to the repository with not leaving items               * locked (if any) after the commit succeeds; this will add aNewDir&               * aNewFile to the repository.               */
name|committedRevision
operator|=
name|commit
argument_list|(
name|wcDir
argument_list|,
literal|false
argument_list|,
literal|"'/newDir' with '/newDir/newFile.txt' were added"
argument_list|)
operator|.
name|getNewRevision
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while committing changes to the working copy at '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Committed to revision "
operator|+
name|committedRevision
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Locking (with stealing if the entry is already locked) '"
operator|+
name|aNewFile
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * locks aNewFile with stealing (if it has been already locked by someone              * else), providing a lock comment              */
name|lock
argument_list|(
name|aNewFile
argument_list|,
literal|true
argument_list|,
literal|"locking '/newDir/newFile.txt'"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while locking the working copy file '"
operator|+
name|aNewFile
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Status for '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"':"
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * displays status once again to see the file is really locked              */
name|showStatus
argument_list|(
name|wcDir
argument_list|,
name|isRecursive
argument_list|,
name|isRemote
argument_list|,
name|isReportAll
argument_list|,
name|isIncludeIgnored
argument_list|,
name|isCollectParentExternals
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while recursively performing status for '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Copying '"
operator|+
name|url
operator|+
literal|"' to '"
operator|+
name|copyURL
operator|+
literal|"'..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * makes a branch of url at copyURL - that is URL->URL copying              * with history              */
name|committedRevision
operator|=
name|copy
argument_list|(
name|url
argument_list|,
name|copyURL
argument_list|,
literal|false
argument_list|,
literal|"remotely copying '"
operator|+
name|url
operator|+
literal|"' to '"
operator|+
name|copyURL
operator|+
literal|"'"
argument_list|)
operator|.
name|getNewRevision
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while copying '"
operator|+
name|url
operator|+
literal|"' to '"
operator|+
name|copyURL
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
comment|/*         * displays what revision the repository was committed to         */
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Committed to revision "
operator|+
name|committedRevision
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Switching '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' to '"
operator|+
name|copyURL
operator|+
literal|"'..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * recursively switches wcDir to copyURL in the latest revision               * (SVNRevision.HEAD)              */
name|switchToURL
argument_list|(
name|wcDir
argument_list|,
name|copyURL
argument_list|,
name|SVNRevision
operator|.
name|HEAD
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while switching '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' to '"
operator|+
name|copyURL
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
comment|/*          * recursively displays info for the working copy once again to see          * it was really switched to a new URL          */
try|try
block|{
name|showInfo
argument_list|(
name|wcDir
argument_list|,
name|SVNRevision
operator|.
name|WORKING
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while recursively getting info for the working copy at'"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Scheduling '"
operator|+
name|aNewDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' for deletion ..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * schedules aNewDir for deletion (with forcing)              */
name|delete
argument_list|(
name|aNewDir
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while schediling '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' for deletion"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Status for '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"':"
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * recursively displays status once more to see whether aNewDir              * was really scheduled for deletion                */
name|showStatus
argument_list|(
name|wcDir
argument_list|,
name|isRecursive
argument_list|,
name|isRemote
argument_list|,
name|isReportAll
argument_list|,
name|isIncludeIgnored
argument_list|,
name|isCollectParentExternals
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while recursively performing status for '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|()
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Committing changes for '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'..."
argument_list|)
expr_stmt|;
try|try
block|{
comment|/*              * lastly commits changes in wcDir to the repository; all items that              * were locked by the user (if any) will be unlocked after the commit               * succeeds; this commit will remove aNewDir from the repository.               */
name|committedRevision
operator|=
name|commit
argument_list|(
name|wcDir
argument_list|,
literal|false
argument_list|,
literal|"deleting '"
operator|+
name|aNewDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' from the filesystem as well as from the repository"
argument_list|)
operator|.
name|getNewRevision
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SVNException
name|svne
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while committing changes to the working copy '"
operator|+
name|wcDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|svne
argument_list|)
expr_stmt|;
block|}
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
literal|"Committed to revision "
operator|+
name|committedRevision
argument_list|)
expr_stmt|;
name|System
operator|.
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
comment|/*      * Initializes the library to work with a repository via       * different protocols.      */
specifier|private
specifier|static
name|void
name|setupLibrary
parameter_list|()
block|{
comment|/*          * For using over http:// and https://          */
name|DAVRepositoryFactory
operator|.
name|setup
argument_list|()
expr_stmt|;
comment|/*          * For using over svn:// and svn+xxx://          */
name|SVNRepositoryFactoryImpl
operator|.
name|setup
argument_list|()
expr_stmt|;
comment|/*          * For using over file:///          */
name|FSRepositoryFactory
operator|.
name|setup
argument_list|()
expr_stmt|;
block|}
comment|/*      * Creates a new version controlled directory (doesn't create any intermediate      * directories) right in a repository. Like 'svn mkdir URL -m "some comment"'       * command. It's done by invoking       *       * SVNCommitClient.doMkDir(SVNURL[] urls, String commitMessage)       *       * which takes the following parameters:      *       * urls - an array of URLs that are to be created;      *       * commitMessage - a commit log message since a URL-based directory creation is       * immediately committed to a repository.      */
specifier|private
specifier|static
name|SVNCommitInfo
name|makeDirectory
parameter_list|(
name|SVNURL
name|url
parameter_list|,
name|String
name|commitMessage
parameter_list|)
throws|throws
name|SVNException
block|{
comment|/*          * Returns SVNCommitInfo containing information on the new revision committed           * (revision number, etc.)           */
return|return
name|ourClientManager
operator|.
name|getCommitClient
argument_list|()
operator|.
name|doMkDir
argument_list|(
operator|new
name|SVNURL
index|[]
block|{
name|url
block|}
argument_list|,
name|commitMessage
argument_list|)
return|;
block|}
comment|/*      * Imports an unversioned directory into a repository location denoted by a      * destination URL (all necessary parent non-existent paths will be created       * automatically). This operation commits the repository to a new revision.       * Like 'svn import PATH URL (-N) -m "some comment"' command. It's done by       * invoking       *       * SVNCommitClient.doImport(File path, SVNURL dstURL, String commitMessage, boolean recursive)       *       * which takes the following parameters:      *       * path - a local unversioned directory or singal file that will be imported into a       * repository;      *       * dstURL - a repository location where the local unversioned directory/file will be       * imported into; this URL path may contain non-existent parent paths that will be       * created by the repository server;      *       * commitMessage - a commit log message since the new directory/file are immediately      * created in the repository;      *       * recursive - if true and path parameter corresponds to a directory then the directory      * will be added with all its child subdirictories, otherwise the operation will cover      * only the directory itself (only those files which are located in the directory).        */
specifier|private
specifier|static
name|SVNCommitInfo
name|importDirectory
parameter_list|(
name|File
name|localPath
parameter_list|,
name|SVNURL
name|dstURL
parameter_list|,
name|String
name|commitMessage
parameter_list|,
name|boolean
name|isRecursive
parameter_list|)
throws|throws
name|SVNException
block|{
comment|/*          * Returns SVNCommitInfo containing information on the new revision committed           * (revision number, etc.)           */
return|return
name|ourClientManager
operator|.
name|getCommitClient
argument_list|()
operator|.
name|doImport
argument_list|(
name|localPath
argument_list|,
name|dstURL
argument_list|,
name|commitMessage
argument_list|,
literal|null
argument_list|,
literal|true
argument_list|,
literal|false
argument_list|,
name|SVNDepth
operator|.
name|fromRecurse
argument_list|(
name|isRecursive
argument_list|)
argument_list|)
return|;
block|}
comment|/*      * Committs changes in a working copy to a repository. Like       * 'svn commit PATH -m "some comment"' command. It's done by invoking       *       * SVNCommitClient.doCommit(File[] paths, boolean keepLocks, String commitMessage,       * boolean force, boolean recursive)       *       * which takes the following parameters:      *       * paths - working copy paths which changes are to be committed;      *       * keepLocks - if true then doCommit(..) won't unlock locked paths; otherwise they will      * be unlocked after a successful commit;       *       * commitMessage - a commit log message;      *       * force - if true then a non-recursive commit will be forced anyway;        *       * recursive - if true and a path corresponds to a directory then doCommit(..) recursively       * commits changes for the entire directory, otherwise - only for child entries of the       * directory;      */
specifier|private
specifier|static
name|SVNCommitInfo
name|commit
parameter_list|(
name|File
name|wcPath
parameter_list|,
name|boolean
name|keepLocks
parameter_list|,
name|String
name|commitMessage
parameter_list|)
throws|throws
name|SVNException
block|{
comment|/*          * Returns SVNCommitInfo containing information on the new revision committed           * (revision number, etc.)           */
return|return
name|ourClientManager
operator|.
name|getCommitClient
argument_list|()
operator|.
name|doCommit
argument_list|(
operator|new
name|File
index|[]
block|{
name|wcPath
block|}
argument_list|,
name|keepLocks
argument_list|,
name|commitMessage
argument_list|,
literal|null
argument_list|,
literal|null
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|,
name|SVNDepth
operator|.
name|INFINITY
argument_list|)
return|;
block|}
comment|/*      * Checks out a working copy from a repository. Like 'svn checkout URL[@REV] PATH (-r..)'      * command; It's done by invoking       *       * SVNUpdateClient.doCheckout(SVNURL url, File dstPath, SVNRevision pegRevision,       * SVNRevision revision, boolean recursive)      *       * which takes the following parameters:      *       * url - a repository location from where a working copy is to be checked out;      *       * dstPath - a local path where the working copy will be fetched into;      *       * pegRevision - an SVNRevision representing a revision to concretize      * url (what exactly URL a user means and is sure of being the URL he needs); in other      * words that is the revision in which the URL is first looked up;      *       * revision - a revision at which a working copy being checked out is to be;       *       * recursive - if true and url corresponds to a directory then doCheckout(..) recursively       * fetches out the entire directory, otherwise - only child entries of the directory;         */
specifier|private
specifier|static
name|long
name|checkout
parameter_list|(
name|SVNURL
name|url
parameter_list|,
name|SVNRevision
name|revision
parameter_list|,
name|File
name|destPath
parameter_list|,
name|boolean
name|isRecursive
parameter_list|)
throws|throws
name|SVNException
block|{
name|SVNUpdateClient
name|updateClient
init|=
name|ourClientManager
operator|.
name|getUpdateClient
argument_list|()
decl_stmt|;
comment|/*          * sets externals not to be ignored during the checkout          */
name|updateClient
operator|.
name|setIgnoreExternals
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|/*          * returns the number of the revision at which the working copy is           */
return|return
name|updateClient
operator|.
name|doCheckout
argument_list|(
name|url
argument_list|,
name|destPath
argument_list|,
name|revision
argument_list|,
name|revision
argument_list|,
name|SVNDepth
operator|.
name|fromRecurse
argument_list|(
name|isRecursive
argument_list|)
argument_list|,
literal|false
argument_list|)
return|;
block|}
comment|/*      * Updates a working copy (brings changes from the repository into the working copy).       * Like 'svn update PATH' command; It's done by invoking       *       * SVNUpdateClient.doUpdate(File file, SVNRevision revision, boolean recursive)       *       * which takes the following parameters:      *       * file - a working copy entry that is to be updated;      *       * revision - a revision to which a working copy is to be updated;      *       * recursive - if true and an entry is a directory then doUpdate(..) recursively       * updates the entire directory, otherwise - only child entries of the directory;         */
specifier|private
specifier|static
name|long
name|update
parameter_list|(
name|File
name|wcPath
parameter_list|,
name|SVNRevision
name|updateToRevision
parameter_list|,
name|boolean
name|isRecursive
parameter_list|)
throws|throws
name|SVNException
block|{
name|SVNUpdateClient
name|updateClient
init|=
name|ourClientManager
operator|.
name|getUpdateClient
argument_list|()
decl_stmt|;
comment|/*          * sets externals not to be ignored during the update          */
name|updateClient
operator|.
name|setIgnoreExternals
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|/*          * returns the number of the revision wcPath was updated to          */
return|return
name|updateClient
operator|.
name|doUpdate
argument_list|(
name|wcPath
argument_list|,
name|updateToRevision
argument_list|,
name|SVNDepth
operator|.
name|fromRecurse
argument_list|(
name|isRecursive
argument_list|)
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|)
return|;
block|}
comment|/*      * Updates a working copy to a different URL. Like 'svn switch URL' command.      * It's done by invoking       *       * SVNUpdateClient.doSwitch(File file, SVNURL url, SVNRevision revision, boolean recursive)       *       * which takes the following parameters:      *       * file - a working copy entry that is to be switched to a new url;      *       * url - a target URL a working copy is to be updated against;      *       * revision - a revision to which a working copy is to be updated;      *       * recursive - if true and an entry (file) is a directory then doSwitch(..) recursively       * switches the entire directory, otherwise - only child entries of the directory;         */
specifier|private
specifier|static
name|long
name|switchToURL
parameter_list|(
name|File
name|wcPath
parameter_list|,
name|SVNURL
name|url
parameter_list|,
name|SVNRevision
name|updateToRevision
parameter_list|,
name|boolean
name|isRecursive
parameter_list|)
throws|throws
name|SVNException
block|{
name|SVNUpdateClient
name|updateClient
init|=
name|ourClientManager
operator|.
name|getUpdateClient
argument_list|()
decl_stmt|;
comment|/*          * sets externals not to be ignored during the switch          */
name|updateClient
operator|.
name|setIgnoreExternals
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|/*          * returns the number of the revision wcPath was updated to          */
return|return
name|updateClient
operator|.
name|doSwitch
argument_list|(
name|wcPath
argument_list|,
name|url
argument_list|,
name|SVNRevision
operator|.
name|UNDEFINED
argument_list|,
name|updateToRevision
argument_list|,
name|SVNDepth
operator|.
name|getInfinityOrFilesDepth
argument_list|(
name|isRecursive
argument_list|)
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|)
return|;
block|}
comment|/*      * Collects status information on local path(s). Like 'svn status (-u) (-N)'       * command. It's done by invoking       *       * SVNStatusClient.doStatus(File path, boolean recursive,       * boolean remote, boolean reportAll, boolean includeIgnored,       * boolean collectParentExternals, ISVNStatusHandler handler)       *       * which takes the following parameters:      *       * path - an entry which status info to be gathered;      *       * recursive - if true and an entry is a directory then doStatus(..) collects status       * info not only for that directory but for each item inside stepping down recursively;      *       * remote - if true then doStatus(..) will cover the repository (not only the working copy)      * as well to find out what entries are out of date;      *       * reportAll - if true then doStatus(..) will also include unmodified entries;      *       * includeIgnored - if true then doStatus(..) will also include entries being ignored;       *       * collectParentExternals - if true then externals definitions won't be ignored;      *       * handler - an implementation of ISVNStatusHandler to process status info per each entry      * doStatus(..) traverses; such info is collected in an SVNStatus object and      * is passed to a handler's handleStatus(SVNStatus status) method where an implementor      * decides what to do with it.        */
specifier|private
specifier|static
name|void
name|showStatus
parameter_list|(
name|File
name|wcPath
parameter_list|,
name|boolean
name|isRecursive
parameter_list|,
name|boolean
name|isRemote
parameter_list|,
name|boolean
name|isReportAll
parameter_list|,
name|boolean
name|isIncludeIgnored
parameter_list|,
name|boolean
name|isCollectParentExternals
parameter_list|)
throws|throws
name|SVNException
block|{
comment|/*          * StatusHandler displays status information for each entry in the console (in the           * manner of the native Subversion command line client)          */
name|ourClientManager
operator|.
name|getStatusClient
argument_list|()
operator|.
name|doStatus
argument_list|(
name|wcPath
argument_list|,
name|SVNRevision
operator|.
name|HEAD
argument_list|,
name|SVNDepth
operator|.
name|fromRecurse
argument_list|(
name|isRecursive
argument_list|)
argument_list|,
name|isRemote
argument_list|,
name|isReportAll
argument_list|,
name|isIncludeIgnored
argument_list|,
name|isCollectParentExternals
argument_list|,
operator|new
name|StatusHandler
argument_list|(
name|isRemote
argument_list|)
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
comment|/*      * Collects information on local path(s). Like 'svn info (-R)' command.      * It's done by invoking       *       * SVNWCClient.doInfo(File path, SVNRevision revision,      * boolean recursive, ISVNInfoHandler handler)       *       * which takes the following parameters:      *       * path - a local entry for which info will be collected;      *       * revision - a revision of an entry which info is interested in; if it's not      * WORKING then info is got from a repository;      *       * recursive - if true and an entry is a directory then doInfo(..) collects info       * not only for that directory but for each item inside stepping down recursively;      *       * handler - an implementation of ISVNInfoHandler to process info per each entry      * doInfo(..) traverses; such info is collected in an SVNInfo object and      * is passed to a handler's handleInfo(SVNInfo info) method where an implementor      * decides what to do with it.           */
specifier|private
specifier|static
name|void
name|showInfo
parameter_list|(
name|File
name|wcPath
parameter_list|,
name|SVNRevision
name|revision
parameter_list|,
name|boolean
name|isRecursive
parameter_list|)
throws|throws
name|SVNException
block|{
comment|/*          * InfoHandler displays information for each entry in the console (in the manner of          * the native Subversion command line client)          */
name|ourClientManager
operator|.
name|getWCClient
argument_list|()
operator|.
name|doInfo
argument_list|(
name|wcPath
argument_list|,
name|SVNRevision
operator|.
name|UNDEFINED
argument_list|,
name|revision
argument_list|,
name|SVNDepth
operator|.
name|getInfinityOrEmptyDepth
argument_list|(
name|isRecursive
argument_list|)
argument_list|,
literal|null
argument_list|,
operator|new
name|InfoHandler
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|/*      * Puts directories and files under version control scheduling them for addition      * to a repository. They will be added in a next commit. Like 'svn add PATH'       * command. It's done by invoking       *       * SVNWCClient.doAdd(File path, boolean force,       * boolean mkdir, boolean climbUnversionedParents, boolean recursive)       *       * which takes the following parameters:      *       * path - an entry to be scheduled for addition;      *       * force - set to true to force an addition of an entry anyway;      *       * mkdir - if true doAdd(..) creates an empty directory at path and schedules      * it for addition, like 'svn mkdir PATH' command;      *       * climbUnversionedParents - if true and the parent of the entry to be scheduled      * for addition is not under version control, then doAdd(..) automatically schedules      * the parent for addition, too;      *       * recursive - if true and an entry is a directory then doAdd(..) recursively       * schedules all its inner dir entries for addition as well.       */
specifier|private
specifier|static
name|void
name|addEntry
parameter_list|(
name|File
name|wcPath
parameter_list|)
throws|throws
name|SVNException
block|{
name|ourClientManager
operator|.
name|getWCClient
argument_list|()
operator|.
name|doAdd
argument_list|(
name|wcPath
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|,
name|SVNDepth
operator|.
name|INFINITY
argument_list|,
literal|false
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
comment|/*      * Locks working copy paths, so that no other user can commit changes to them.      * Like 'svn lock PATH' command. It's done by invoking       *       * SVNWCClient.doLock(File[] paths, boolean stealLock, String lockMessage)       *       * which takes the following parameters:      *       * paths - an array of local entries to be locked;      *       * stealLock - set to true to steal the lock from another user or working copy;      *       * lockMessage - an optional lock comment string.      */
specifier|private
specifier|static
name|void
name|lock
parameter_list|(
name|File
name|wcPath
parameter_list|,
name|boolean
name|isStealLock
parameter_list|,
name|String
name|lockComment
parameter_list|)
throws|throws
name|SVNException
block|{
name|ourClientManager
operator|.
name|getWCClient
argument_list|()
operator|.
name|doLock
argument_list|(
operator|new
name|File
index|[]
block|{
name|wcPath
block|}
argument_list|,
name|isStealLock
argument_list|,
name|lockComment
argument_list|)
expr_stmt|;
block|}
comment|/*      * Schedules directories and files for deletion from version control upon the next      * commit (locally). Like 'svn delete PATH' command. It's done by invoking       *       * SVNWCClient.doDelete(File path, boolean force, boolean dryRun)       *       * which takes the following parameters:      *       * path - an entry to be scheduled for deletion;      *       * force - a boolean flag which is set to true to force a deletion even if an entry      * has local modifications;      *       * dryRun - set to true not to delete an entry but to check if it can be deleted;      * if false - then it's a deletion itself.        */
specifier|private
specifier|static
name|void
name|delete
parameter_list|(
name|File
name|wcPath
parameter_list|,
name|boolean
name|force
parameter_list|)
throws|throws
name|SVNException
block|{
name|ourClientManager
operator|.
name|getWCClient
argument_list|()
operator|.
name|doDelete
argument_list|(
name|wcPath
argument_list|,
name|force
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
comment|/*      * Duplicates srcURL to dstURL (URL->URL)in a repository remembering history.      * Like 'svn copy srcURL dstURL -m "some comment"' command. It's done by      * invoking       *       * doCopy(SVNURL srcURL, SVNRevision srcRevision, SVNURL dstURL,       * boolean isMove, String commitMessage)       *       * which takes the following parameters:      *       * srcURL - a source URL that is to be copied;      *       * srcRevision - a definite revision of srcURL       *       * dstURL - a URL where srcURL will be copied; if srcURL& dstURL are both       * directories then there are two cases:       * a) dstURL already exists - then doCopy(..) will duplicate the entire source       * directory and put it inside dstURL (for example,       * consider srcURL = svn://localhost/rep/MyRepos,       * dstURL = svn://localhost/rep/MyReposCopy, in this case if doCopy(..) succeeds       * MyRepos will be in MyReposCopy - svn://localhost/rep/MyReposCopy/MyRepos);       * b) dstURL doesn't exist yet - then doCopy(..) will create a directory and      * recursively copy entries from srcURL into dstURL (for example, consider the same      * srcURL = svn://localhost/rep/MyRepos, dstURL = svn://localhost/rep/MyReposCopy,       * in this case if doCopy(..) succeeds MyRepos entries will be in MyReposCopy, like:      * svn://localhost/rep/MyRepos/Dir1 -> svn://localhost/rep/MyReposCopy/Dir1...);        *       * isMove - if false then srcURL is only copied to dstURL what      * corresponds to 'svn copy srcURL dstURL -m "some comment"'; but if it's true then      * srcURL will be copied and deleted - 'svn move srcURL dstURL -m "some comment"';       *       * commitMessage - a commit log message since URL->URL copying is immediately       * committed to a repository.      */
specifier|private
specifier|static
name|SVNCommitInfo
name|copy
parameter_list|(
name|SVNURL
name|srcURL
parameter_list|,
name|SVNURL
name|dstURL
parameter_list|,
name|boolean
name|isMove
parameter_list|,
name|String
name|commitMessage
parameter_list|)
throws|throws
name|SVNException
block|{
comment|/*          * SVNRevision.HEAD means the latest revision.          * Returns SVNCommitInfo containing information on the new revision committed           * (revision number, etc.)           */
return|return
name|ourClientManager
operator|.
name|getCopyClient
argument_list|()
operator|.
name|doCopy
argument_list|(
operator|new
name|SVNCopySource
index|[]
block|{
operator|new
name|SVNCopySource
argument_list|(
name|SVNRevision
operator|.
name|HEAD
argument_list|,
name|SVNRevision
operator|.
name|HEAD
argument_list|,
name|srcURL
argument_list|)
block|}
argument_list|,
name|dstURL
argument_list|,
name|isMove
argument_list|,
literal|true
argument_list|,
literal|false
argument_list|,
name|commitMessage
argument_list|,
literal|null
argument_list|)
return|;
block|}
comment|/*      * Displays error information and exits.       */
specifier|private
specifier|static
name|void
name|error
parameter_list|(
name|String
name|message
parameter_list|,
name|Exception
name|e
parameter_list|)
block|{
name|System
operator|.
name|err
operator|.
name|println
argument_list|(
name|message
operator|+
operator|(
name|e
operator|!=
literal|null
condition|?
literal|": "
operator|+
name|e
operator|.
name|getMessage
argument_list|()
else|:
literal|""
operator|)
argument_list|)
expr_stmt|;
name|System
operator|.
name|exit
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
comment|/*      * This method does not relate to SVNKit API. Just a method which creates      * local directories and files :)      */
specifier|private
specifier|static
specifier|final
name|void
name|createLocalDir
parameter_list|(
name|Resource
name|aNewDir
parameter_list|,
name|Resource
index|[]
name|localFiles
parameter_list|,
name|String
index|[]
name|fileContents
parameter_list|)
block|{
if|if
condition|(
operator|!
name|aNewDir
operator|.
name|mkdirs
argument_list|()
condition|)
block|{
name|error
argument_list|(
literal|"failed to create a new directory '"
operator|+
name|aNewDir
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'."
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|localFiles
operator|.
name|length
condition|;
name|i
operator|++
control|)
block|{
name|Resource
name|aNewFile
init|=
name|localFiles
index|[
name|i
index|]
decl_stmt|;
try|try
block|{
if|if
condition|(
operator|!
name|aNewFile
operator|.
name|createNewFile
argument_list|()
condition|)
block|{
name|error
argument_list|(
literal|"failed to create a new file '"
operator|+
name|aNewFile
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'."
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
name|aNewFile
operator|.
name|delete
argument_list|()
expr_stmt|;
name|error
argument_list|(
literal|"error while creating a new file '"
operator|+
name|aNewFile
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|ioe
argument_list|)
expr_stmt|;
block|}
name|String
name|contents
init|=
literal|null
decl_stmt|;
if|if
condition|(
name|i
operator|>
name|fileContents
operator|.
name|length
operator|-
literal|1
condition|)
block|{
continue|continue;
block|}
name|contents
operator|=
name|fileContents
index|[
name|i
index|]
expr_stmt|;
comment|/* 	         * writing a text into the file 	         */
name|OutputStream
name|fos
init|=
literal|null
decl_stmt|;
try|try
block|{
name|fos
operator|=
name|aNewFile
operator|.
name|getOutputStream
argument_list|()
expr_stmt|;
name|fos
operator|.
name|write
argument_list|(
name|contents
operator|.
name|getBytes
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|FileNotFoundException
name|fnfe
parameter_list|)
block|{
name|error
argument_list|(
literal|"the file '"
operator|+
name|aNewFile
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"' is not found"
argument_list|,
name|fnfe
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
name|error
argument_list|(
literal|"error while writing into the file '"
operator|+
name|aNewFile
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"'"
argument_list|,
name|ioe
argument_list|)
expr_stmt|;
block|}
finally|finally
block|{
if|if
condition|(
name|fos
operator|!=
literal|null
condition|)
block|{
try|try
block|{
name|fos
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
comment|//
block|}
block|}
block|}
block|}
block|}
annotation|@
name|BeforeClass
specifier|public
specifier|static
name|void
name|initDB
parameter_list|()
block|{
comment|// initialize XML:DB driver
try|try
block|{
name|Class
argument_list|<
name|?
argument_list|>
name|cl
init|=
name|Class
operator|.
name|forName
argument_list|(
literal|"org.exist.xmldb.DatabaseImpl"
argument_list|)
decl_stmt|;
name|Database
name|database
init|=
operator|(
name|Database
operator|)
name|cl
operator|.
name|newInstance
argument_list|()
decl_stmt|;
name|database
operator|.
name|setProperty
argument_list|(
literal|"create-database"
argument_list|,
literal|"true"
argument_list|)
expr_stmt|;
name|DatabaseManager
operator|.
name|registerDatabase
argument_list|(
name|database
argument_list|)
expr_stmt|;
name|org
operator|.
name|xmldb
operator|.
name|api
operator|.
name|base
operator|.
name|Collection
name|root
init|=
name|DatabaseManager
operator|.
name|getCollection
argument_list|(
literal|"xmldb:exist://"
operator|+
name|DBBroker
operator|.
name|ROOT_COLLECTION
argument_list|,
literal|"admin"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|CollectionManagementService
name|mgmt
init|=
operator|(
name|CollectionManagementService
operator|)
name|root
operator|.
name|getService
argument_list|(
literal|"CollectionManagementService"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
try|try
block|{
name|mgmt
operator|.
name|removeCollection
argument_list|(
name|myWorkingCopyName
argument_list|)
expr_stmt|;
name|mgmt
operator|.
name|removeCollection
argument_list|(
name|importDirName
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|XMLDBException
name|e
parameter_list|)
block|{
block|}
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
name|fail
argument_list|(
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
annotation|@
name|AfterClass
specifier|public
specifier|static
name|void
name|closeDB
parameter_list|()
block|{
try|try
block|{
name|Collection
name|root
init|=
name|DatabaseManager
operator|.
name|getCollection
argument_list|(
literal|"xmldb:exist://"
operator|+
name|DBBroker
operator|.
name|ROOT_COLLECTION
argument_list|,
literal|"admin"
argument_list|,
literal|null
argument_list|)
decl_stmt|;
comment|// CollectionManagementService cmgr = (CollectionManagementService)
comment|// root.getService("CollectionManagementService", "1.0");
comment|// cmgr.removeCollection("test");
name|DatabaseInstanceManager
name|mgr
init|=
operator|(
name|DatabaseInstanceManager
operator|)
name|root
operator|.
name|getService
argument_list|(
literal|"DatabaseInstanceManager"
argument_list|,
literal|"1.0"
argument_list|)
decl_stmt|;
name|mgr
operator|.
name|shutdown
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|XMLDBException
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
name|fail
argument_list|(
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_class

end_unit

