begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_package
package|package
name|org
operator|.
name|exist
operator|.
name|fluent
package|;
end_package

begin_import
import|import
name|org
operator|.
name|jmock
operator|.
name|Mock
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jmock
operator|.
name|core
operator|.
name|Constraint
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jmock
operator|.
name|core
operator|.
name|Invocation
import|;
end_import

begin_import
import|import
name|org
operator|.
name|jmock
operator|.
name|core
operator|.
name|Stub
import|;
end_import

begin_comment
comment|/**  * Created by IntelliJ IDEA.  * User: wessels  * Date: Oct 29, 2007  * Time: 8:53:16 PM  * To change this template use File | Settings | File Templates.  */
end_comment

begin_class
specifier|public
class|class
name|ListenerManagerTest
extends|extends
name|DatabaseHelper
block|{
specifier|private
name|Mock
name|documentListener
decl_stmt|;
specifier|private
name|Mock
name|folderListener
decl_stmt|;
specifier|private
name|Mock
name|bothListener
decl_stmt|;
specifier|private
name|Document
operator|.
name|Listener
name|documentListenerProxy
decl_stmt|;
specifier|private
name|Folder
operator|.
name|Listener
name|folderListenerProxy
decl_stmt|;
specifier|private
name|BothListener
name|bothListenerProxy
decl_stmt|;
annotation|@
name|Override
specifier|protected
name|void
name|setUp
parameter_list|()
block|{
name|super
operator|.
name|setUp
argument_list|()
expr_stmt|;
name|documentListener
operator|=
name|mock
argument_list|(
name|Document
operator|.
name|Listener
operator|.
name|class
argument_list|)
expr_stmt|;
name|folderListener
operator|=
name|mock
argument_list|(
name|Folder
operator|.
name|Listener
operator|.
name|class
argument_list|)
expr_stmt|;
name|bothListener
operator|=
name|mock
argument_list|(
name|BothListener
operator|.
name|class
argument_list|)
expr_stmt|;
name|documentListenerProxy
operator|=
operator|(
name|Document
operator|.
name|Listener
operator|)
name|documentListener
operator|.
name|proxy
argument_list|()
expr_stmt|;
name|folderListenerProxy
operator|=
operator|(
name|Folder
operator|.
name|Listener
operator|)
name|folderListener
operator|.
name|proxy
argument_list|()
expr_stmt|;
name|bothListenerProxy
operator|=
operator|(
name|BothListener
operator|)
name|bothListener
operator|.
name|proxy
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Override
specifier|protected
name|void
name|tearDown
parameter_list|()
throws|throws
name|Exception
block|{
name|super
operator|.
name|tearDown
argument_list|()
expr_stmt|;
name|ListenerManager
operator|.
name|INSTANCE
operator|.
name|remove
argument_list|(
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|ListenerManager
operator|.
name|INSTANCE
operator|.
name|remove
argument_list|(
name|folderListenerProxy
argument_list|)
expr_stmt|;
name|ListenerManager
operator|.
name|INSTANCE
operator|.
name|remove
argument_list|(
name|bothListenerProxy
argument_list|)
expr_stmt|;
name|documentListener
operator|=
literal|null
expr_stmt|;
name|folderListener
operator|=
literal|null
expr_stmt|;
name|bothListener
operator|=
literal|null
expr_stmt|;
name|documentListenerProxy
operator|=
literal|null
expr_stmt|;
name|folderListenerProxy
operator|=
literal|null
expr_stmt|;
name|bothListenerProxy
operator|=
literal|null
expr_stmt|;
block|}
specifier|private
name|Constraint
name|eqDelayedDoc
parameter_list|(
specifier|final
name|Document
operator|.
name|Event
name|ev
parameter_list|)
block|{
return|return
operator|new
name|Constraint
argument_list|()
block|{
specifier|public
name|StringBuffer
name|describeTo
parameter_list|(
name|StringBuffer
name|buf
parameter_list|)
block|{
return|return
name|buf
operator|.
name|append
argument_list|(
literal|"eqDelayedDoc("
argument_list|)
operator|.
name|append
argument_list|(
name|ev
argument_list|)
operator|.
name|append
argument_list|(
literal|")"
argument_list|)
return|;
block|}
specifier|public
name|boolean
name|eval
parameter_list|(
name|Object
name|o
parameter_list|)
block|{
return|return
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|ev
operator|.
name|trigger
argument_list|,
name|ev
operator|.
name|path
argument_list|,
name|db
operator|.
name|getDocument
argument_list|(
name|ev
operator|.
name|path
argument_list|)
argument_list|)
operator|.
name|equals
argument_list|(
name|o
argument_list|)
return|;
block|}
block|}
return|;
block|}
specifier|private
name|Stub
name|checkDocumentExists
parameter_list|(
specifier|final
name|String
name|path
parameter_list|,
specifier|final
name|boolean
name|shouldExist
parameter_list|)
block|{
return|return
operator|new
name|Stub
argument_list|()
block|{
specifier|public
name|StringBuffer
name|describeTo
parameter_list|(
name|StringBuffer
name|buf
parameter_list|)
block|{
return|return
name|buf
operator|.
name|append
argument_list|(
literal|"check that document '"
operator|+
name|path
operator|+
literal|"' "
operator|+
operator|(
name|shouldExist
condition|?
literal|"exists"
else|:
literal|"does not exist"
operator|)
argument_list|)
return|;
block|}
specifier|public
name|Object
name|invoke
parameter_list|(
name|Invocation
name|inv
parameter_list|)
throws|throws
name|Throwable
block|{
try|try
block|{
name|db
operator|.
name|getDocument
argument_list|(
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|shouldExist
condition|)
name|fail
argument_list|(
literal|"document '"
operator|+
name|path
operator|+
literal|"' exists but shouldn't"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|DatabaseException
name|e
parameter_list|)
block|{
if|if
condition|(
name|shouldExist
condition|)
name|fail
argument_list|(
literal|"document '"
operator|+
name|path
operator|+
literal|"' doesn't exist but should"
argument_list|)
expr_stmt|;
block|}
return|return
literal|null
return|;
block|}
block|}
return|;
block|}
specifier|private
name|Stub
name|checkFolderExists
parameter_list|(
specifier|final
name|String
name|path
parameter_list|,
specifier|final
name|boolean
name|shouldExist
parameter_list|)
block|{
return|return
operator|new
name|Stub
argument_list|()
block|{
specifier|public
name|StringBuffer
name|describeTo
parameter_list|(
name|StringBuffer
name|buf
parameter_list|)
block|{
return|return
name|buf
operator|.
name|append
argument_list|(
literal|"check that folder '"
operator|+
name|path
operator|+
literal|"' "
operator|+
operator|(
name|shouldExist
condition|?
literal|"exists"
else|:
literal|"does not exist"
operator|)
argument_list|)
return|;
block|}
specifier|public
name|Object
name|invoke
parameter_list|(
name|Invocation
name|inv
parameter_list|)
throws|throws
name|Throwable
block|{
try|try
block|{
name|db
operator|.
name|getFolder
argument_list|(
name|path
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|shouldExist
condition|)
name|fail
argument_list|(
literal|"folder '"
operator|+
name|path
operator|+
literal|"' exists but shouldn't"
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|DatabaseException
name|e
parameter_list|)
block|{
if|if
condition|(
name|shouldExist
condition|)
name|fail
argument_list|(
literal|"folder '"
operator|+
name|path
operator|+
literal|"' doesn't exist but should"
argument_list|)
expr_stmt|;
block|}
return|return
literal|null
return|;
block|}
block|}
return|;
block|}
specifier|private
name|Stub
name|checkDocumentStamp
parameter_list|(
specifier|final
name|String
name|expectedStamp
parameter_list|)
block|{
return|return
operator|new
name|Stub
argument_list|()
block|{
specifier|public
name|StringBuffer
name|describeTo
parameter_list|(
name|StringBuffer
name|buf
parameter_list|)
block|{
name|buf
operator|.
name|append
argument_list|(
literal|"check that event document is stamped with '"
operator|+
name|expectedStamp
operator|+
literal|"'"
argument_list|)
expr_stmt|;
return|return
name|buf
return|;
block|}
specifier|public
name|Object
name|invoke
parameter_list|(
name|Invocation
name|inv
parameter_list|)
throws|throws
name|Throwable
block|{
name|XMLDocument
name|doc
init|=
operator|(
operator|(
name|Document
operator|.
name|Event
operator|)
name|inv
operator|.
name|parameterValues
operator|.
name|get
argument_list|(
literal|0
argument_list|)
operator|)
operator|.
name|document
operator|.
name|xml
argument_list|()
decl_stmt|;
name|assertNotNull
argument_list|(
literal|"event document is null"
argument_list|,
name|doc
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|expectedStamp
argument_list|,
name|doc
operator|.
name|query
argument_list|()
operator|.
name|single
argument_list|(
literal|"/test/@stamp"
argument_list|)
operator|.
name|value
argument_list|()
argument_list|)
expr_stmt|;
return|return
literal|null
return|;
block|}
block|}
return|;
block|}
specifier|private
name|XMLDocument
name|createDocument
parameter_list|(
name|String
name|path
parameter_list|)
block|{
return|return
name|createDocument
argument_list|(
name|path
argument_list|,
literal|null
argument_list|)
return|;
block|}
specifier|private
name|XMLDocument
name|createDocument
parameter_list|(
name|String
name|path
parameter_list|,
name|String
name|stamp
parameter_list|)
block|{
name|int
name|k
init|=
name|path
operator|.
name|lastIndexOf
argument_list|(
literal|'/'
argument_list|)
decl_stmt|;
assert|assert
name|k
operator|>
literal|0
assert|;
name|Folder
name|folder
init|=
name|db
operator|.
name|createFolder
argument_list|(
name|path
operator|.
name|substring
argument_list|(
literal|0
argument_list|,
name|k
argument_list|)
argument_list|)
decl_stmt|;
return|return
name|folder
operator|.
name|documents
argument_list|()
operator|.
name|build
argument_list|(
name|Name
operator|.
name|overwrite
argument_list|(
name|path
operator|.
name|substring
argument_list|(
name|k
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|.
name|elem
argument_list|(
literal|"test"
argument_list|)
operator|.
name|attrIf
argument_list|(
name|stamp
operator|!=
literal|null
argument_list|,
literal|"stamp"
argument_list|,
name|stamp
argument_list|)
operator|.
name|end
argument_list|(
literal|"test"
argument_list|)
operator|.
name|commit
argument_list|()
return|;
block|}
specifier|public
name|void
name|testListenDocumentsBeforeCreateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|docPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentsBeforeCreateDocument2
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|never
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|ANYTHING
argument_list|)
expr_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|remove
argument_list|(
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentsAfterCreateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_CREATE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eqDelayedDoc
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentsAfterCreateDocument2
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|never
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|ANYTHING
argument_list|)
expr_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|remove
argument_list|(
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderBeforeCreateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test2.xml"
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|docPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderBeforeCreateDocument2
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test2.xml"
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|never
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|ANYTHING
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|remove
argument_list|(
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderAfterCreateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test2.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_CREATE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eqDelayedDoc
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderAfterCreateDocument2
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test2.xml"
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|never
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|ANYTHING
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|remove
argument_list|(
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentsBeforeUpdateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"before"
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_UPDATE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentStamp
argument_list|(
literal|"before"
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_UPDATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"after"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentsAfterUpdateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"before"
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_UPDATE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentStamp
argument_list|(
literal|"after"
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_UPDATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"after"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderBeforeUpdateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"before"
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_UPDATE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentStamp
argument_list|(
literal|"before"
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_UPDATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"after"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderAfterUpdateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"before"
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_UPDATE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentStamp
argument_list|(
literal|"after"
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_UPDATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"after"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderDeepBeforeCreateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/middle/test2.xml"
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|docPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentBeforeUpdateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"before"
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_UPDATE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentStamp
argument_list|(
literal|"before"
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_UPDATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"after"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/test2.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentAfterUpdateDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"before"
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_UPDATE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentStamp
argument_list|(
literal|"after"
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_UPDATE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"after"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/test2.xml"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentsBeforeDeleteDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentsBeforeDeleteDocument2
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|,
literal|"before"
argument_list|)
decl_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eqDelayedDoc
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentsAfterDeleteDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_DELETE
argument_list|,
name|docPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|top
operator|.
name|documents
argument_list|()
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|createDocument
argument_list|(
name|docPath
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderBeforeDeleteDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderBeforeDeleteDocument2
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/deeper/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderAfterDeleteDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_DELETE
argument_list|,
name|docPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testListenFolderAfterDeleteDocument2
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/deeper/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_DELETE
argument_list|,
name|docPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentBeforeDeleteDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|docPath
argument_list|,
name|doc
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/test2.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|testListenDocumentAfterDeleteDocument1
parameter_list|()
block|{
specifier|final
name|String
name|docPath
init|=
literal|"/top/test.xml"
decl_stmt|;
name|XMLDocument
name|doc
init|=
name|createDocument
argument_list|(
name|docPath
argument_list|)
decl_stmt|;
name|Document
operator|.
name|Event
name|ev
init|=
operator|new
name|Document
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|AFTER_DELETE
argument_list|,
name|docPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|documentListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkDocumentExists
argument_list|(
name|docPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|AFTER_DELETE
argument_list|,
name|documentListenerProxy
argument_list|)
expr_stmt|;
name|doc
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/elsewhere/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/deeper/test.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
name|createDocument
argument_list|(
literal|"/top/test2.xml"
argument_list|)
operator|.
name|delete
argument_list|()
expr_stmt|;
block|}
specifier|public
name|void
name|bugtestListenBeforeCreateFolder1
parameter_list|()
block|{
specifier|final
name|String
name|folderPath
init|=
literal|"/top/child"
decl_stmt|;
name|Folder
operator|.
name|Event
name|ev
init|=
operator|new
name|Folder
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|folderPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|folderListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkFolderExists
argument_list|(
name|folderPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|folderListenerProxy
argument_list|)
expr_stmt|;
name|top
operator|.
name|children
argument_list|()
operator|.
name|create
argument_list|(
literal|"child"
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|bugtestListenBeforeCreateFolder2
parameter_list|()
block|{
specifier|final
name|String
name|folderPath
init|=
literal|"/top/middle/child"
decl_stmt|;
name|Folder
operator|.
name|Event
name|ev
init|=
operator|new
name|Folder
operator|.
name|Event
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|folderPath
argument_list|,
literal|null
argument_list|)
decl_stmt|;
name|folderListener
operator|.
name|expects
argument_list|(
name|once
argument_list|()
argument_list|)
operator|.
name|method
argument_list|(
literal|"handle"
argument_list|)
operator|.
name|with
argument_list|(
name|eq
argument_list|(
name|ev
argument_list|)
argument_list|)
operator|.
name|will
argument_list|(
name|checkFolderExists
argument_list|(
name|folderPath
argument_list|,
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|Folder
name|top
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top"
argument_list|)
decl_stmt|;
name|Folder
name|middle
init|=
name|db
operator|.
name|createFolder
argument_list|(
literal|"/top/middle"
argument_list|)
decl_stmt|;
name|top
operator|.
name|listeners
argument_list|()
operator|.
name|add
argument_list|(
name|Trigger
operator|.
name|BEFORE_CREATE
argument_list|,
name|folderListenerProxy
argument_list|)
expr_stmt|;
name|middle
operator|.
name|children
argument_list|()
operator|.
name|create
argument_list|(
literal|"child"
argument_list|)
expr_stmt|;
block|}
specifier|private
interface|interface
name|BothListener
extends|extends
name|Document
operator|.
name|Listener
extends|,
name|Folder
operator|.
name|Listener
block|{
comment|/*nothing to add*/
block|}
block|}
end_class

end_unit

