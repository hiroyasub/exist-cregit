<?xml version="1.0" encoding="UTF-8"?>
<Policy PolicyId="JavaMathReflectionPolicy" RuleCombiningAlgId="urn:oasis:names:tc:xacml:1.0:rule-combining-algorithm:ordered-permit-overrides" xmlns="urn:oasis:names:tc:xacml:1.0:policy" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<Description>
		A sample policy that applies to the java.lang.Math class.  It allows access to random()
		by the guest user, but nothing else.
	</Description>
	
	<Target>
		<Resources>
			<Resource>
				<ResourceMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal">
					<AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string">java.lang.Math</AttributeValue>
					<ResourceAttributeDesignator AttributeId="http://exist-db.org/xacml/class" DataType="http://www.w3.org/2001/XMLSchema#string" MustBePresent="true"/>
				</ResourceMatch>
			</Resource>
		</Resources>
	</Target>
	
	<Rule RuleId="AllowMath" Effect="Permit">
		
		<Description>
			This rule allows the java.lang.Math class itself to be loaded in a query.
		</Description>
		
		<Target>
			<Resources>
				<Resource>
					<ResourceMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal">
						<AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string">class</AttributeValue>
						<ResourceAttributeDesignator AttributeId="http://exist-db.org/xacml/resource#resource-category" DataType="http://www.w3.org/2001/XMLSchema#string" MustBePresent="true"/>
					</ResourceMatch>
				</Resource>
			</Resources>
		</Target>
		
	</Rule>
	
	<Rule RuleId="AllowRandom" Effect="Permit">
		
		<Description>
			This rule allows a method named random to be invoked from a query by the guest user.
		</Description>
		
		<Target>
			<Resources>
				<Resource>
					<ResourceMatch MatchId="urn:oasis:names:tc:xacml:1.0:function:string-equal">
						<AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string">random</AttributeValue>
						<ResourceAttributeDesignator DataType="http://www.w3.org/2001/XMLSchema#string" AttributeId="urn:oasis:names:tc:xacml:1.0:resource:resource-id" MustBePresent="true"/>
					</ResourceMatch>
				</Resource>
			</Resources>
		</Target>
		
		<Condition FunctionId="urn:oasis:names:tc:xacml:1.0:function:and">
			<Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:string-equal">
				<Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:string-one-and-only">
					<ResourceAttributeDesignator AttributeId="http://exist-db.org/xacml/resource#resource-category" DataType="http://www.w3.org/2001/XMLSchema#string" MustBePresent="true"/>
				</Apply>
				<AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string">method</AttributeValue>
			</Apply>
			<Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:string-equal">
				<Apply FunctionId="urn:oasis:names:tc:xacml:1.0:function:string-one-and-only">
					<SubjectAttributeDesignator AttributeId="urn:oasis:names:tc:xacml:1.0:subject:subject-id" DataType="http://www.w3.org/2001/XMLSchema#string" MustBePresent="true"/>
				</Apply>
				<AttributeValue DataType="http://www.w3.org/2001/XMLSchema#string">guest</AttributeValue>
			</Apply>
   	</Condition>
		
	</Rule>
	
	<Rule RuleId="DenyAllOthers" Effect="Deny">
		<Description>
			This rule denies access to all other methods.
		</Description>
	</Rule>
</Policy>
